# 내가 이해하고 있는 방향에 대해 이야기해보려 한다.

## - 정보들

_ AVCaptureDevice 는 장치다. 후면 카메라, 전면 카메라, 마이크.

_ AVCaptureDeviceInput 은 AVCaptureDevice 로부터 들어오는 입력 값이다.

__ 이 AVCaptureDeviceInput 은 AVCaptureDevice 정보를 가지고 만들어진다. 쉽게 말하자면, 후면 카메라인지 전면 카메라인지, 그 중에서도 광각인지 등등의 정보를 가지고 AVCaptureDeviceInput 값을 생성한다는 뜻.

_ 근데 이 AVCaptureDevice 가 분명 여러가지일 텐데, 이들은 AVCaptureDevice.DiscoverySession 안에 배열(?) 형태로 저장되어 있다. 'devices'를 통해 각각의 장치들에 접근할 수 있다. 전면, 후면, 광각(?) 등.

<br><br>

# 세션 구성하는 부분

*__?__* 

AVCaptureSession 은 class PreviewView 의 AVCaptureSession과 연결시켜 만들어놓았던데, 이는 어떻게 되먹은 구조인지 잘 모르겠다.AVCaptureSession이 AVCaptureDevice -> AVCaptureDeviceInput -> AVCaptureSession -> AVCapturePhotoOutput / AVCaptureMovieFileOutput / AVCaptureVideoPreviewLayer 이런 흐름으로 가는 것은 알겠지만 *__정확히 어떤 역할을 하는지 모르기 때문에 그런듯 하다.__*

<br><br>

*__?__* 

또한 Session Queue 라는 label 을 가진, DispatchQueue 에서 AVCaptureSession 을 셋업하고, 스탑하고, beginConfiguration(), commitConfiguration() 하던데, 왜 그렇게 하는지 모르겠다. 이 DispatchQueue 는 Main인지 Global인지도 모르겠고, 우선순위가 어떻게 되는지를 모르겠단 말이지..

<br><br>

_ 무튼, AVCaptureSession 의 setup 단계에서 sessionPreset 을 정해주어야 한다. 사진을 찍을 것인지 비디오를 녹화할 것인지, 사진이라면 고하질인지 저화질인지, 비디오라면 1K 2K 4K 따위를 설정해준다. 

<br>

_ 이렇게 프리셋이 설정되면, beginConfiguration()을 통해 구성을 시작한다.

<br><br>

*__?__*

*Declaration

func beginConfiguration()

*Discussion

You use beginConfiguration and commitConfiguration() to batch multiple configuration operations on a running session into an atomic update.
After calling beginConfiguration, you can for example add or remove outputs, alter the sessionPreset, or configure individual capture input or output properties. No changes are actually made until you invoke commitConfiguration(), at which time they are applied together.

<br>

*마지막 두 문장을 번역: 

"beginConfiguration을 호출 한 후 예를 들어 출력을 추가 또는 제거하거나 sessionPreset을 변경하거나 개별 캡처 입력 또는 출력 속성을 구성 할 수 있습니다. 실제로 변경 사항은 commitConfiguration ()을 호출 할 때까지 이루어지지 않고 함께 적용됩니다."

*__그러니까 beginConfiguration() 후에.. 뭐? 무슨 말인지 하나도 이해가 안간다. 다음에는 꼭 이해가 되길 바라며 기록해둔다.__*

<br><br>

*__?__* 

그리고 사용자가 원하는 카메라를 찾지 못했다면 리턴하면서 commitConfiguration() 을 호출하고, 원하는 카메라를 찾았다면 해당 AVCaptureDevice(원하는 장치=원하는 카메라)를 가지고, AVCaptureDeviceInput 을 만들고, 이를 가지고 AVCaptureSession 에게 이거 인풋해도 돼? 물어본다. 

> 문서에는 "주어진 입력을 세션에 추가 할 수 있는지 여부를 나타내는 부울 값을 리턴합니다." 라고 나와있는데, *__추가할 수 없는 경우란 무엇일까?__*
> 
> Summary: Returns a Boolean value that indicates whether a given input can be added to the session.

<br>

무튼 canAddInput 메소드를 통해 가능 여부를 물어보고, 가능하다면 addInput 메소드를 이용해 AVCaptureDeviceInput 을 전달한다. 말 그대로 AVCaptureSession 에게 AVCaptureDeviceInput 을 추가하는 것이다.

> Summary: Adds a given input to the session.

<br><br>

_ 이후에 AVCapturePhotoOutput 에게 사진을 어떤 방식으로 찍을지 설정해준다.

setPreparedPhotoSettingsArray(_ preparedPhotoSettingsArray: [AVCapturePhotoSettings], completionHandler: ((Bool, Error?) -> Void)? = nil) 을 통해서.

> Summary: Tells the photo capture output to prepare resources for future capture requests with the specified settings. 
>
> 번역: 지정된 설정으로 향후 캡처 요청을 위해 리소스를 준비하도록 사진 캡처 출력에 지시합니다.

<br><br>

_ AVCapturePhotoOutput 에게 설정이 끝났으면, AVCaptureSession 에게 AVCaptureOutput 줘도 돼? 라고 물어본다. canAddOutput 메소드를 통해 물어본다. 가능하다는 말이 돌아오면, AVCaptureOutput 을 세션에게 준다.

----
[func setupSession 마지막부터 이어서 복기하면 됨]